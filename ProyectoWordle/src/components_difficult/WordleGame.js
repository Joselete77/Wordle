import confetti from 'https://cdn.skypack.dev/canvas-confetti'
//import WORDS from "../assets/palabras_4.json";
const WORDS = ["abad","abey","abia","abra","abur","abas","acal","acle","acma","acne","acna","acre","acta","acto","adir","ador","adra","adul","adan","aeda","aedo","aeta","afer","afro","afta","afan","afan","agio","agre","agro","agua","agur","aire","aisa","aita","ajar","ajea","ajeo","alar","alba","albo","alca","alce","alea","alfa","alga","algo","alim","alla","alla","alla","alma","almo","alna","alno","aloe","alta","alto","alud","alza","alzo","alan","alan","alaa","amar","ambo","amia","amir","amok","amol","amor","amos","ampo","aman","aman","aman","anal","anay","anca","anda","anea","anga","anoa","ansa","ansa","anta","ante","anuo","anas","anan","aojo","apea","apeo","apio","apto","apud","apas","aqua","arar","arca","arce","arco","arda","arel","aria","ario","arlo","arma","arna","aron","arpa","arra","arre","arta","arte","arto","aran","aran","asar","asaz","asca","asco","aseo","asir","asma","asna","asno","aspa","asta","asan","atal","atar","ateo","atol","atan","atan","auca","auge","aula","aura","auto","aval","avol","avao","axil","axis","axan","ayer","ayma","ayaa","azar","azor","azua","azud","azul","azur","azut","aana","añal","añas","añil","añir","añas","aapa","agil","alef","aloe","amel","apex","area","azoe","baba","babi","baca","bada","baga","bago","baga","baja","bajo","baja","bala","balo","baro","bara","basa","base","bata","bate","bato","bata","baya","bayo","baya","baya","baza","bazo","baña","baño","baal","bebe","beba","beca","befa","befo","beis","beso","beta","bezo","biba","bici","bida","bien","bies","bife","biga","bija","bina","biso","bita","biza","blao","bloc","bobo","boca","bock","boda","bode","body","bofe","bofo","boga","boja","boje","bojo","bola","boli","bolo","bona","bono","boom","boro","bota","bote","boto","boya","boza","bozo","boal","bran","brea","bren","brin","broa","brut","brao","buba","bubi","buba","buco","buda","buen","buey","bufa","bufo","bufa","buje","bujo","bula","bule","bulo","bula","buna","bura","buro","bura","bura","buso","buyo","buzo","baer","baho","cabe","cabo","caca","caco","cada","cadi","cado","cada","caer","cafa","caja","cajo","caja","caja","cala","cale","cali","calo","cala","cala","cama","cama","cana","cano","cana","caos","capa","capi","capo","capa","capa","capa","cara","cari","caro","casa","casi","caso","cata","cate","cato","cauz","cava","cavo","cava","caya","cayo","caya","caza","cazo","caad","caña","caño","caña","ceba","cebo","ceba","ceca","ceda","cedo","cefo","ceja","ceje","cejo","ceja","cela","cele","celo","cena","cena","cepa","cepo","cera","cero","cese","ceño","chai","chal","chan","chao","chas","chau","chef","chic","chin","chip","chis","chia","choz","chus","chut","chuz","chaa","cian","ciar","cibi","cibo","cica","cien","cija","cima","cina","cinc","cine","cipe","cipo","cita","cito","clac","clan","clic","clin","clip","cloc","clon","club","coba","cobo","coca","coco","coca","coda","codo","cofa","coja","cojo","cola","cole","colo","coma","como","cono","copa","cope","copo","copa","cora","cori","coro","cora","cosa","coso","cota","cote","coto","cota","cota","coxa","coya","coña","coño","coña","crac","cran","cras","crea","crep","cric","crin","crol","cron","crup","cruz","craa","crao","cual","cuan","cuba","cubo","cuca","cuco","cuca","cuin","cuis","cuja","cuje","cuja","culi","culo","cula","cuma","cuna","cupe","cupo","cupa","cura","cura","cute","cuto","cuta","cuya","cuye","cuyo","cuya","cuzo","cual","cuan","cuña","cuño","camo","cayo","daca","daca","dada","dado","dada","daga","dala","dama","data","dato","daza","daño","deal","debe","deba","dedo","deja","deje","dejo","dele","dese","dean","dial","diez","dije","dina","dino","dios","dita","dita","diva","divo","doca","doce","doga","dogo","dola","dolo","doma","domo","dona","dond","dote","doña","drea","dril","draa","dual","duba","duco","duda","dugo","dujo","dula","duma","duna","dura","duro","daho","echo","ecuo","edad","edil","edan","efod","eira","ejem","elfo","elle","ello","emir","ende","enea","enta","ente","enza","eral","erar","ergo","eros","erre","erro","eraa","erao","esca","eser","esos","este","euro","exir","anea","aneo","asos","aste","ater","faba","fabo","faca","fada","fado","fago","faja","fajo","falo","fama","fame","fano","fara","faro","fase","fato","favo","faya","feje","feta","feto","fiar","fice","fido","fiel","fifa","figo","fija","fijo","fila","film","filo","fimo","fino","fito","fiñe","flan","fleo","flor","flux","foca","foco","fofo","foja","folk","fona","fono","foro","fosa","foso","foto","foya","frac","fray","freo","frey","frez","friz","frui","fraa","frao","fuco","fuel","fuer","fuet","fufo","fufa","fuga","fuir","fula","fuma","fumo","furo","fusa","fuso","faat","gafa","gafe","gafo","gaga","gago","gaga","gaje","gajo","gala","galo","gama","gamo","gana","garo","gasa","gata","gato","gaya","gayo","gaza","gaan","gema","geno","geta","giba","giga","gila","gira","giro","glas","glaa","goce","godo","gofo","gogo","goga","goja","gola","golf","goma","gong","gota","gozo","gran","grao","gray","gres","grey","gris","grog","gros","graa","guao","guau","guay","guja","gula","gura","guri","guro","gura","gura","guaa","güin","haba","haca","hada","hado","hala","hale","hall","halo","hamo","hato","havo","haya","hayo","haza","heno","hico","hiel","higa","higo","hijo","hila","hilo","hipo","hita","hito","hobo","hoce","hogo","hoja","hola","home","homo","hopa","hopo","hora","hoto","hove","hoya","hoyo","huir","hule","humo","huno","hupe","hura","hura","huso","huta","ibis","iban","icho","icor","idea","ideo","idos","idus","igla","ijar","illa","illo","imam","iman","inca","indo","inga","inga","inri","inti","iota","ipil","iris","isba","isla","ismo","izar","adem","aleo","atem","jaba","jaba","jaca","jaco","jada","jade","jaez","jama","jane","jara","jaro","jasa","jata","jate","jato","javo","jazz","jaan","jebe","jeda","jefa","jefe","jeme","jera","jeta","jeto","jibe","jico","jifa","jiga","jina","jipa","jipi","jira","jiña","jobo","joco","joca","jopo","jopa","jora","josa","josa","jota","jote","joto","joya","joyo","juan","juba","jubo","juco","juca","judo","juey","juez","jugo","julo","juma","jumo","jupa","jura","juro","jusi","juta","kaki","kilo","kivi","kiwi","kril","labe","laca","lada","lado","lady","lago","laja","lama","lama","lana","lapa","lapo","laso","lata","lato","lava","lave","laxo","laya","lazo","laña","laad","leal","leco","ledo","leer","lega","lego","leja","lelo","lema","leme","lena","lene","lepe","lera","leso","leva","leve","leña","leñe","leño","lean","liar","liga","lija","lijo","lila","lima","limo","lino","lipa","lira","lisa","liso","lita","lite","liza","lizo","liña","liño","llar","loar","loba","lobo","loca","loco","lodo","loja","loma","lomo","lona","look","loor","lora","lord","loro","losa","lota","lote","loto","loza","luco","ludo","luir","luis","lujo","lulo","lula","luma","luna","lupa","luso","luto","laes","maba","maca","mach","maco","maca","mago","maja","maje","majo","maja","mala","malo","mama","mama","mana","mani","mano","mana","mana","mapa","mapo","mara","maro","mara","masa","mata","mate","mato","maya","mayo","maza","mazo","maaz","maña","maño","mear","meca","meco","meda","medo","mega","mego","mela","mema","memo","mena","mena","mere","mero","mesa","meta","meya","mean","miar","miau","mica","mico","mida","miel","mies","miga","mijo","mili","mime","mimo","mina","mino","mira","misa","miso","miss","mita","mito","miza","mizo","moca","moco","moda","modo","moer","mofa","mogo","moho","moje","mojo","moja","mola","mole","molo","momo","mona","moni","mono","mora","moro","mota","mote","moto","moxa","moya","moyo","moza","mozo","moña","moño","muco","muda","mudo","muer","mufa","muga","muir","mula","mule","mulo","muna","mura","muro","musa","muta","Adan","Aman","Amas","Azul","Baba","Blas","Bona","Cabo","Cava","Caan","Ceca","Eros","Jesa","Josa","Juan","Lepe","Lean","Mach","Meca","Moro","Paco","Pepa","Pero","Pera","Quao","Remo","Rita","Roma","Rota","Tola","Tule","Veda","Vega","naba","nabo","naba","naco","nada","nadi","nado","naif","naja","nana","nano","napa","nasa","naso","nata","nato","nava","nave","nazi","neba","neis","neja","nema","neme","nene","nena","nepe","neto","nexo","nean","nial","nido","niel","nipa","nito","niña","niño","noca","nodo","noli","nola","noma","nome","nomo","nona","nono","nota","noto","nova","noxa","noya","nube","nuca","nuco","nudo","nuez","nulo","numo","nuño","ñame","ñapa","ñata","ñato","ñaña","ñaño","ñeco","ñipe","ñire","ñoco","ñola","ñora","ñoño","ñuco","ñudo","ñuto","oboe","obra","obua","obas","ocal","ocho","ocio","ocle","ocre","odio","odre","ogro","ojal","ojar","ojeo","ojan","oler","olio","olla","olma","olmo","olor","omba","once","onda","onde","onza","open","opio","opus","oque","oral","orar","orbe","orca","orco","orea","oreo","orfo","orla","orlo","orto","orza","oran","oran","osar","osco","osta","oste","otar","otre","otri","otro","oval","ovar","ovas","ovil","ovio","ovni","oxte","oada","oado","aleo","anix","aseo","paca","paco","paca","paga","pago","paja","paje","pajo","pala","pali","palo","pala","pana","pano","pana","papa","papo","papa","papa","para","paro","para","pasa","pase","paso","pata","pate","pato","pata","pata","pava","pavo","paya","payo","paya","pazo","paas","pañi","paño","paña","paal","pchs","peal","peca","pece","pedo","peer","pega","pego","peje","pela","pelo","pela","pena","pene","peno","peor","pepa","pepe","pepa","pera","peri","pero","pesa","peso","peta","peto","pean","peña","peño","pean","pial","pian","piar","pibe","pica","pico","piel","pija","pije","pijo","pila","pilo","pina","pino","pipa","pipe","pipi","pipo","pipa","pira","piro","pira","pisa","piso","pita","pite","pito","pian","piña","piño","pian","plan","plus","pobo","poco","poda","podo","poli","polo","poma","pomo","poni","popa","pope","popo","pora","poro","posa","pose","poso","post","posa","pota","pote","poto","poya","poyo","poza","pozo","prao","prea","prez","proa","puar","puda","pues","pufo","puga","puja","pujo","puma","puna","punk","pupa","pupo","puro","pura","puta","puto","puya","puyo","puño","quia","quid","quif","quin","quaa","quao","raba","rabo","raba","rada","raer","rafa","rafe","raga","rail","rain","raja","raje","raja","ralo","rama","ramo","rana","rano","rapa","rape","rapo","rapa","rara","raro","rasa","raso","rasa","rata","rato","raya","rayo","raza","raal","raaz","raña","raño","real","reis","reja","rejo","rela","remo","rene","reno","repo","reps","reto","rezo","rear","rial","riba","rica","rico","riel","rifa","rija","rijo","rima","rima","ring","risa","riso","rita","rite","rito","riza","rizo","riña","robo","roca","roce","rock","roda","rodo","roel","roer","rogo","rojo","rola","rolo","roma","romo","roma","ropa","rosa","roso","rota","roto","roya","royo","roza","rozo","roña","ruar","rubo","ruba","ruca","ruco","ruda","rudo","rufo","ruga","ruin","rula","rulo","rula","rumo","ruma","runa","runo","ruso","ruta","ruan","saca","saco","saga","sago","saga","saja","sake","sala","sama","sano","sant","sapa","sapo","sari","sara","sato","sauz","saxo","saya","sayo","saan","saña","sebe","sebo","seca","sece","seco","seda","sede","seer","sega","seis","seje","sema","sena","sene","seno","seor","sepe","sera","seso","sesa","seta","sete","seto","sexo","sexy","seña","show","sian","sicu","sida","sien","sija","silo","sima","sino","siro","sisa","sito","slip","soba","sobo","soca","soda","soez","sofa","sofa","soga","soja","solo","soma","somo","sopa","sora","soro","sosa","soso","sota","sote","soto","soya","spot","suba","suco","sucu","sufa","sula","suma","sumo","sura","surf","suri","sura","suso","sute","suyo","salo","taba","tabo","taba","taba","taca","taco","tael","tafo","taha","taja","tajo","taja","taja","tala","talo","tamo","tana","tano","tapa","tape","tara","tasa","tasi","tata","tate","tato","tata","taxi","taza","taño","teca","teda","tefe","teja","tejo","tela","tele","tema","temu","tena","tepe","tepa","tero","teso","test","teta","teyo","teya","teña","tibe","tico","tifo","tija","tila","tile","tilo","timo","tina","tino","tipa","tipo","tira","tiro","tisa","titi","tito","tita","tiza","tizo","tiña","toar","toba","toca","toco","todo","tofo","toga","tojo","tola","tole","tola","toma","tomo","tona","tono","tona","tona","topa","tope","topo","tora","toro","tosa","tose","tote","toti","tota","tova","toza","tozo","toña","tras","tren","treo","tres","tris","troj","trol","trox","trun","trua","traa","trao","tuba","tubo","tuca","tuco","tuda","tufo","tule","tumo","tuna","tuno","tupa","tupo","tupa","tupa","tura","tusa","tuse","tuso","tuta","tute","tuto","tutu","tuta","tuya","tuyo","tuza","ubio","ubre","uced","uchu","ucha","ugre","ulpo","unir","unja","unto","upar","urao","urbe","urca","urce","urdu","urea","urna","usar","usgo","uste","usaa","uval","uñir","atil","avea","vaca","vaco","vade","vado","vafo","vaga","vago","vaho","vale","vals","vala","vano","vara","vara","vasa","vaso","vate","vaya","veda","veer","vega","vela","velo","vena","vera","vero","veta","veto","veza","vezo","vial","vico","vida","vide","viga","vilo","vino","vira","visa","viso","vito","vivo","viña","voda","volt","voso","voto","vuda","watt","yaba","yaca","yana","yang","yapa","yapa","yare","yaro","yate","yaya","yayo","yebo","yeco","yema","yero","yeso","yeti","yodo","yoga","yola","yoyo","yoya","yuan","yubo","yuca","yudo","yugo","yura","yuso","yuta","yute","yuyo","zaca","zade","zafa","zafo","zaga","zala","zana","zapa","zape","zata","zaya","zazo","zeda","zeta","zinc","zoca","zoco","zoma","zona","zope","zopo","zote","zuda","zula","zuma","zumo","zuna","zuro","zuzo","zuño"];
import "./WordleWord.js";
import "./WordleKeyboard.js";
import "./WordleSummary.js";

const LOSE_SOUND = new Audio("sounds/lose.mp3");
const WIN_SOUND = new Audio("sounds/win.mp3");

const LETTERS = [
  "q", "w", "e", "r", "t", "y", "u", "i", "o", "p",
  "a", "s", "d", "f", "g", "h", "j", "k", "l", "ñ",
  "z", "x", "c", "v", "b", "n", "m"
];

class WordleGame extends HTMLElement {
    constructor() {
      super();
      this.attachShadow({ mode: "open" });
      this.startGame();
    }
  
    static get styles() {
      return /* css */`
        :host {
          --exact-color: #6aaa64;
          --exist-color: #c9b458;
          --used-color: #3a3a3c;
          font-family: Montserrat, sans-serif;
        }
        .container {
          display: flex;
          flex-direction: column;
          justify-content: space-between;
          align-items: center;
          height: 100vh;
        }
        h1 {
          text-transform: uppercase;
          border-bottom: 1px solid #555;
          margin-bottom: 0;
        }
        h2 {
          font-weight: lighter;
          font-size: 1rem;
          text-align: center;
          margin: 0;
        }
        h2 a {
          color: #f4b400;
        }
        h2 a:hover {
          color: #a22;
        }
        .words {
          display: flex;
          flex-direction: column;
          font-weight: bold;
        }
        * {
        margin: 0;
        padding: 0;
      }
      html {
        font-size: 16px;
        font-family: 'Roboto', sans-serif;
      }
      body {
        background: #d1d1d1;
      }
      .checkbox {
        display: none;
      }
      header {
        position: fixed;
        width: 100%;
        z-index: 10;
      }
      .header-container {
        width: 90%;
        position: relative;
        margin: 1rem auto;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .header-logo {
        width: 4rem;
      }
      .btn-label {
        width: 2rem;
        height: 1.4rem;
      }
      .header-button {
        width: 2rem;
        height: 0.2rem;
        background: #000;
        position: absolute;
        top: 1.9rem;  
        transition: all 0.2s;
      }
      .header-button::before,
      .header-button::after {
        content: "";
        width: 2rem;
        height: 0.2rem;
        background: #000;
        position: absolute;
        top: -0.6rem;
        transition: all 0.2s;
      }
      .header-button::after {
        top: 0.6rem;
      }
      .menu {
        background: #d1d1d1;
        width: 100%;
        height: 10rem;
        position: fixed;
        z-index: 9;
        top: -12rem;
        display: flex;
        flex-direction: column;
        justify-content: space-around;
        text-align: center;
        padding-top: 2rem;
        transition: all 0.5s;
      }
      ul {
        list-style: none;
      }
      li {
        margin: 0.5rem;
      }
      a {
        margin: 0 1rem;
        color: #000;
        text-decoration: none;
      }
      .checkbox:checked ~ .menu {
        background: #rgb(221, 220, 220);
        top: 0rem;
      }
      .checkbox:checked + header .header-container label .header-button {
        background: none;
      }
      .checkbox:checked + header .header-container label .header-button::before {
        transform: rotate(35deg);
        top: 0;
      }
      .checkbox:checked + header .header-container label .header-button::after {
        transform: rotate(-35deg);
        top: 0;
      }
      `;
    }
  
    startGame() {
      const randomIndex = Math.floor(Math.random() * WORDS.length);
      this.secretWord = WORDS[randomIndex].toLowerCase();
      // console.log(this.secretWord);
      this.ending = false;
    }
  
    connectedCallback() {
      this.render();
      this.currentWord = this.shadowRoot.querySelector("wordle-word[current]");
      this.keyboard = this.shadowRoot.querySelector("wordle-keyboard");
      document.addEventListener("keyup", (ev) => this.pushLetter(ev.key));
      document.addEventListener("keyboard", (ev) => this.pushLetter(ev.detail));
      this.addEventListener("KEYBOARD_SET_LETTER", (ev) => this.keyboard.setLetter(ev.detail.letter, ev.detail.className));
    }
  
    pushLetter(letter) {
      if (this.ending) { return; }
  
      const key = letter.toLowerCase();
      const isEnter = key === "enter";
      const isBackSpace = key === "backspace";
  
      isEnter && this.checkRestrictions();
      isBackSpace && this.currentWord.removeLetter();
  
      const isLetter = LETTERS.includes(key);
      const isEmptyWord = this.currentWord.isEmpty();
  
      if (isLetter && isEmptyWord) {
        this.currentWord.addLetter(key);
      }
    }
  
    checkRestrictions() {
      const isEmpty = this.currentWord.isEmpty();
      if (isEmpty) {
        alert("La palabra debe tener 5 letras");
        return;
      }
  
      const word = this.currentWord.toString();
      const existentWord = WORDS.includes(word);
      if (!existentWord) {
        alert("No existe esta palabra en el diccionario");
        return;
      }
  
      const solved = this.currentWord.resolve(this.secretWord);
      if (!solved) {
        this.nextWord();
        return;
      }
  
      this.win();
    }
  
    nextWord() {
      this.currentWord = this.shadowRoot.querySelector("wordle-word[current]");
      const nextWord = this.currentWord.nextElementSibling;
  
      if (nextWord) {
        nextWord.setAttribute("current", "");
        this.currentWord.removeAttribute("current");
        this.currentWord = nextWord;
        return;
      }
  
      this.lose();
    }
  
    win() {
      WIN_SOUND.play();
      confetti();
      this.startSummary(true);
      this.ending = true;
    }
  
    lose() {
      LOSE_SOUND.play();
      this.startSummary(false);
      this.ending = true;
    }
  
    startSummary(winner) {
      const container = this.shadowRoot.querySelector(".container");
      const summary = document.createElement("wordle-summary");
      summary.setSecretWord(this.secretWord);
      summary.setWinner(winner);
      summary.setStats(this.shadowRoot.querySelectorAll("wordle-word"));
      container.insertAdjacentElement("beforeend", summary);
    }
  
    render() {
      this.shadowRoot.innerHTML = /* html */`
      <style>${WordleGame.styles}</style>
      <div class="container">
      <input type="checkbox" id="btn-nav" class="checkbox">
        <header>
          <div class="header-container">
            <a  href="wordle_difficult.html"><img class="header-logo" src="./assets/images/W.png"></a> 
            <label for="btn-nav" class="btn-label">
              <div class="header-button"></div> 
            </label>
          </div> 
        </header>
      <nav class="menu">
        <ul>
        <a style= "position: relative; top: -15px" href="./assets/html/indexEditarPerfil.html"> <b>Editar perfil</b></a>
        <a style= "position: relative; top: -15px" href="./assets/html/indexAmigos.html"> <b>Amigos </b></a>
        <a style= "position: relative; top: -15px" href="./assets/php/mostrar_blog.php"> <b>Blog </b></a>
        <a style= "position: relative; top: -15px" href="./assets/html/dificultad.html"> <b>Elegir dificultad </b></a>
        <a style= "position: relative; top: -15px" href="./assets/html/comingsoon.html"> <b>Puntuacion </b></a>
        <a style= "position: relative; top: -15px" href="./assets/html/comingsoon.html"> <b>Chat </b></a>
        <a style= "position: relative; top: -15px" href="./assets/html/comingsoon.html"> <b>Modo daltonico </b></a>
        <a style= "position: relative; top: -15px" href="./assets/php/cerrar_sesion.php"> <b>Cerrar sesión </b></a>
        </ul>      
      </nav>           

        <div class="words">
          <wordle-word current></wordle-word>
          <wordle-word></wordle-word>
          <wordle-word></wordle-word>
          <wordle-word></wordle-word>
          <wordle-word></wordle-word>
          <wordle-word></wordle-word>
          <wordle-word></wordle-word>

        </div>
        <wordle-keyboard></wordle-keyboard>
      </div>`;
    }
  }

  document.getElementById('id-sun').onclick = function(){
    document.getElementById('page').classList.remove('dark-mode')
    document.getElementById('id-moon').classList.remove('active')
    this.classList.add('active')
  }

  document.getElementById('id-moon').onclick = function(){
    document.getElementById('page').classList.add('dark-mode')
    document.getElementById('id-sun').classList.remove('active')
    this.classList.add('active')
  }
  
  customElements.define("wordle-game", WordleGame);